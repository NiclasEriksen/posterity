{% extends "base.html" %}
{% block page_title %}Dashboard - Posterity{% endblock %}
{% block metadata %}
<meta property="og:site_name" content="Posterity video">
<meta property="og:title" content="Editor dashboard" />
<meta property="og:image" itemprop="image" content="{{ url_for('serve.static', filename='posterity.png') }}">
<meta property="og:type" content="website" />
{% endblock %}
{% block content %}
<section class="uk-section uk-section-small uk-section-muted uk-padding-remove-vertical">
    <div class="uk-container">
        <h2>Welcome, {{ user.username }}</h2>
    </div>
</section>
<section class="uk-section uk-section-default uk-section-small">
    <div class="uk-container uk-margin-small">
        <div class="uk-container uk-margin">
            <h2>Current tasks:</h2>
            <table class="uk-table uk-table-small uk-table-striped">
                <thead>
                    <tr>
                        <td>Title</td>
                        <td>Uploader/Status</td>
                    </tr>
                </thead>
                <tbody>
                    {% for t in tasks %}
                    <tr>
                        <td><a href="/{{ t.video_id }}">{{ t.title }}</a></td>
                        <td><span class="uk-text-meta">{{ t.source }}</span> {{ t.status_str.capitalize() }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</section>
<section class="uk-section uk-section-default uk-section-small uk-container">
    <div class="uk-grid uk-grid-small">
        <div clasS="uk-width-1-1">
            <h2>Tools:</h2>
        </div>
        <div class="uk-width-1-1 uk-width-1-2@m uk-padding-small">
            <a class="uk-input uk-button uk-button-warning" href="/check_all_duplicates">
                <span uk-icon="icon: copy"></span> Full duplicate check
            </a>
        </div>
    </div>
</section>
<section class="uk-section uk-section-default uk-section-small uk-container">
    <div class="uk-grid uk-grid-small">
        <div class="uk-width-1-1 uk-width-1-2@m uk-margin">
            <h2>Add new tag:</h2>
            <form class="uk-form" method="POST" id="add_tag_form" action="/add_tag">
                <fieldset class="uk-fieldset">
                    <div class="uk-margin">
                        <input type="text" class="uk-input" name="tag_name" id="tag_name" placeholder="Tag name">
                    </div>
                    <div class="uk-margin">
                        <select class="uk-select" id="tag_category_select" name="tag_category_select">
                            <option value="0" selected>Informative</option>
                            <option value="1">Emotional</option>
                            <option value="2">Graphic</option>
                        </select>
                    </div>
                    <button class="uk-button uk-button-primary" type="submit">Submit</button>
                    <input type="hidden" id="return_url" name="return_url" value="/dashboard">
                </fieldset>
            </form>
        </div>
        <div class="uk-width-1-1 uk-width-1-2@m uk-margin">
            <h2>Add new category:</h2>
            <form class="uk-form" method="POST" id="add_category_form" action="/add_category">
                <fieldset class="uk-fieldset">
                    <div class="uk-margin">
                        <input type="text" class="uk-input" name="category_name" id="category_name" placeholder="Category name">
                    </div>
                    <button class="uk-button uk-button-primary" type="submit">Submit</button>
                    <input type="hidden" id="return_url_category" name="return_url" value="/dashboard">
                </fieldset>
            </form>
        </div>
    </div>
</section>
<section class="uk-section uk-section-default uk-section-small uk-container">
    <div class="uk-grid uk-grid-small">
        <div class="uk-width-1-1 uk-width-1-2@m uk-margin">
            <h2>Available tokens:</h2>
            <table class="uk-table">
                <thead>
                    <tr>
                        <td class="uk-table-expand">Name/Token</td>
                        <td class="uk-table-shrink">Uses</td>
                        <td>Expires</td>
                    </tr>
                </thead>
                <tbody>
                    {% for token in tokens %}
                    <tr>
                        <td>
                            {{ token.name }}<br>
                            <a
                                href="/dashboard/delete_token/{{ token.id }}"
                                class="uk-icon-link uk-text-danger"
                                uk-icon="icon: trash;ratio: 0.9;"
                            >
                            </a>
                            <span class="uk-text-meta">{{ token.token }}</span>
                        </td>
                        <td>{{ token.uses }}</td>
                        <td><span class="uk-text-meta">{{ token.expires.strftime('%Y-%m-%d') }}</span></td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        <div class="uk-width-1-1 uk-width-1-2@m uk-margin">
            <h2>Add new registration token:</h2>
            <form class="uk-form" method="POST" id="add_token_form" action="/dashboard/create_token">
                <div class="uk-margin">
                    <input type="text" class="uk-input" name="token_name" id="token_name" placeholder="Token name">
                </div>
                <div class="uk-grid-small" uk-grid>
                    <div class="uk-width-1-1 uk-width-1-2@s">
                        <div class="uk-form-label">Authentication level</div>
                        User (0) <input type="range" class="uk-range uk-width-auto" step="1" value="0" min="0" max="{{ current_user.auth_level }}" name="auth_level" id="auth_level" placeholder="Token name"> ({{ current_user.auth_level }}) your level
                    </div>
                    <div class="uk-width-1-1 uk-width-1-2@s">
                        <div class="uk-form-label">Uses</div>
                        <input type="number" min="0" value="1" max="20" class="uk-input" name="token_uses" id="token_uses" placeholder="Token uses">
                    </div>
                </div>
                <button class="uk-button uk-button-primary" type="submit">Submit</button>
            </form>
        </div>
    </div>
</section>
<section class="uk-section uk-section-default uk-section-small">
    <div class="uk-container uk-margin-small">
        {% if other_users|length %}
        <div class="uk-grid-small" uk-grid>
            <h2 class="uk-width-1-1">Other users:</h2>
            {% for u in other_users %}
            <div class="uk-width-1-1 uk-margin-remove">
                <span class="uk-text-meta">User:</span> {{ u.username }}
                <span class="uk-text-meta">ID:</span> {{ u.id }}
                <span class="uk-text-meta">Auth:</span> {{ u.auth_level }}
                <span class="uk-text-meta">Videos:</span> {{ u.uploaded }}
            </div>
            {% endfor %}
        </div>
        {% endif %}
    </div>
</section>
{% endblock %}