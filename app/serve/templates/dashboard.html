{% extends "base.html" %}
{% block page_title %}Dashboard - Posterity{% endblock %}
{% block metadata %}
<meta property="og:site_name" content="Posterity video">
<meta property="og:title" content="Editor dashboard" />
<meta property="og:image" itemprop="image" content="{{ url_for('serve.static', filename='posterity.png') }}">
<meta property="og:type" content="website" />
{% endblock %}
{% block content %}
<section class="uk-section uk-section-small uk-section-muted uk-padding-remove-vertical">
    <div class="uk-container">
        <h2>Welcome, {{ user.username }}</h2>
    </div>
</section>
<section class="uk-section uk-section-default uk-section-small">
    <div class="uk-container uk-margin-small">
        <div class="uk-container uk-margin">
            <h2>Current tasks:</h2>
            <table class="uk-table uk-table-small uk-table-striped">
                <thead>
                    <tr>
                        <td>Title</td>
                        <td>Uploader/Status</td>
                    </tr>
                </thead>
                <tbody>
                    {% for v in tasks %}
                    <tr>
                        <td>
                            <div class="list-thumbnail uk-position-relative" style="display: table-cell;">
                                <a href="/{{ v.video_id }}">
                                    <img src="/thumbnail/{{ v.video_id }}.jpg" loading="lazy" class="thumbnail-rounded uk-position-absolute uk-position-center">
                                </a>
                            </div>
                            <div style="display: table-cell;">
                                <a href="/{{ v.video_id }}">{{ v.title }}</a>
                            </div>
                        </td>
                        <td>
                            <span class="uk-text-meta">{{ v.source }}</span><br>
                            <span class="uk-text-small">
                            {% if v.status != STATUS_COMPLETED and not v.user_reports|length %}
                            {{ v.status_str.capitalize() }}
                            {% if not v.can_be_changed %}
                                {{ v.progress }}
                                {% if v.pid > 0 %}
                                <br><a href="/api/v1/core/cancel_task/{{ v.task_id }}" class="uk-text-danger">
                                    <span class="uk-link-icon" uk-icon="icon: close; ratio: 0.8;"></span> Cancel
                                </a>
                                {% endif %}
                            {% endif %}
                            {% else %}
                            Reports pending
                            {% endif %}
                            </span>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% if duplicates|length %}
        <div class="uk-container uk-margin expandable-duplicates" hidden>
            <h2>Possible duplicates:</h2>
            <table class="uk-table uk-table-small uk-table-striped">
                <thead>
                    <tr>
                        <td class="uk-width-1-5 uk-text-center"></td>
                        <td class="uk-width-2-5 uk-text-center">Video 1</td>
                        <td class="uk-width-2-5 uk-text-center">Video 2</td>
                    </tr>
                </thead>
                <tbody>
                    {% for v1, v2 in duplicates %}
                    <tr>
                        <td><a href="/clear_duplicate?v1={{ v1.video_id }}&v2={{ v2.video_id }}">Clear</a></td>
                        <td>
                            <div class="list-thumbnail uk-position-relative" style="display: table-cell;">
                                <a href="/{{ v1.video_id }}">
                                    <img src="/thumbnail/{{ v1.video_id }}.jpg" loading="lazy" class="thumbnail-rounded uk-position-absolute uk-position-center">
                                </a>
                            </div>
                            <div style="display: table-cell;">
                                <a href="/{{ v1.video_id }}">{{ v1.title }}</a>
                            </div>
                        </td>
                        <td>
                            <div class="list-thumbnail uk-position-relative" style="display: table-cell;">
                                <a href="/{{ v2.video_id }}">
                                    <img src="/thumbnail/{{ v2.video_id }}.jpg" loading="lazy" class="thumbnail-rounded uk-position-absolute uk-position-center">
                                </a>
                            </div>
                            <div style="display: table-cell;">
                                <a href="/{{ v2.video_id }}">{{ v2.title }}</a>
                            </div>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        <div class="uk-width-1-1 uk-position-relative" style="height: 48px;">
            <a
                class="uk-button uk-button-secondary uk-position-center"
                uk-toggle="target: .expandable-duplicates; animation: uk-animation-fade"
            >
                <span class="expandable-duplicates">Show duplicates ({{ duplicates|length }})</span>
                <span class="expandable-duplicates" hidden>Hide duplicates</span>
            </a>
        </div>
        {% endif %}
    </div>
</section>
<section class="uk-section uk-section-default uk-section-small uk-container">
    <div class="uk-grid uk-grid-small">
        <div clasS="uk-width-1-1">
            <h2>Tools:</h2>
        </div>
        <div class="uk-width-1-1 uk-width-1-2@m uk-padding-small">
            <a class="uk-input uk-button uk-button-warning" href="/check_all_duplicates">
                <span uk-icon="icon: copy"></span> Full duplicate check
            </a>
        </div>
    </div>
</section>
<section class="uk-section uk-section-default uk-section-small uk-container">
    <div class="uk-grid uk-grid-small">
        <div class="uk-width-1-1 uk-width-1-2@m uk-margin">
            <h2>Add new tag:</h2>
            <form class="uk-form" method="POST" id="add_tag_form" action="/add_tag">
                <fieldset class="uk-fieldset">
                    <div class="uk-margin">
                        <input type="text" class="uk-input" name="tag_name" id="tag_name" placeholder="Tag name">
                    </div>
                    <div class="uk-margin">
                        <select class="uk-select" id="tag_category_select" name="tag_category_select">
                            <option value="0" selected>Informative</option>
                            <option value="1">Emotional</option>
                            <option value="2">Graphic</option>
                        </select>
                    </div>
                    <button class="uk-button uk-button-primary" type="submit">Submit</button>
                    <input type="hidden" id="return_url" name="return_url" value="/dashboard">
                </fieldset>
            </form>
        </div>
        <div class="uk-width-1-1 uk-width-1-2@m uk-margin">
            <h2>Add new category:</h2>
            <form class="uk-form" method="POST" id="add_category_form" action="/add_category">
                <fieldset class="uk-fieldset">
                    <div class="uk-margin">
                        <input type="text" class="uk-input" name="category_name" id="category_name" placeholder="Category name">
                    </div>
                    <button class="uk-button uk-button-primary" type="submit">Submit</button>
                    <input type="hidden" id="return_url_category" name="return_url" value="/dashboard">
                </fieldset>
            </form>
        </div>
    </div>
</section>
<section class="uk-section uk-section-default uk-section-small uk-container">
    <div class="uk-grid uk-grid-small">
        <div class="uk-width-1-1 uk-width-1-2@m uk-margin">
            <h2>Available tokens:</h2>
            <table class="uk-table">
                <thead>
                    <tr>
                        <td class="uk-table-expand">Name/Token</td>
                        <td class="uk-table-shrink">Uses</td>
                        <td>Expires</td>
                    </tr>
                </thead>
                <tbody>
                    {% for token in tokens %}
                    <tr>
                        <td>
                            {{ token.name }}<br>
                            <a
                                href="/dashboard/delete_token/{{ token.id }}"
                                class="uk-icon-link uk-text-danger"
                                uk-icon="icon: trash;ratio: 0.9;"
                            >
                            </a>
                            <span class="uk-text-meta">{{ token.token }}</span>
                        </td>
                        <td>{{ token.uses }}</td>
                        <td><span class="uk-text-meta">{{ token.expires.strftime('%Y-%m-%d') }}</span></td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        <div class="uk-width-1-1 uk-width-1-2@m uk-margin">
            <h2>Add new registration token:</h2>
            <form class="uk-form" method="POST" id="add_token_form" action="/dashboard/create_token">
                <div class="uk-margin">
                    <input type="text" class="uk-input" name="token_name" id="token_name" placeholder="Token name">
                </div>
                <div class="uk-grid-small" uk-grid>
                    <div class="uk-width-1-1 uk-width-1-2@s">
                        <div class="uk-form-label">Authentication level</div>
                        User (0) <input type="range" class="uk-range uk-width-auto" step="1" value="0" min="0" max="{{ current_user.auth_level }}" name="auth_level" id="auth_level" placeholder="Token name"> ({{ current_user.auth_level }}) your level
                    </div>
                    <div class="uk-width-1-1 uk-width-1-2@s">
                        <div class="uk-form-label">Uses</div>
                        <input type="number" min="0" value="1" max="20" class="uk-input" name="token_uses" id="token_uses" placeholder="Token uses">
                    </div>
                </div>
                <button class="uk-button uk-button-primary" type="submit">Submit</button>
            </form>
        </div>
    </div>
</section>
<section class="uk-section uk-section-default uk-section-small">
    <div class="uk-container uk-margin-small">
        {% if other_users|length %}
        <div class="uk-grid-small" uk-grid>
            <h2 class="uk-width-1-1">Other users:</h2>
            {% for u in other_users %}
            <div class="uk-width-1-1 uk-margin-remove">
                <span class="uk-text-meta">User:</span> {{ u.username }}
                <span class="uk-text-meta">ID:</span> {{ u.id }}
                <span class="uk-text-meta">Auth:</span> {{ u.auth_level }}
                <span class="uk-text-meta">Videos:</span> {{ u.uploaded }}
            </div>
            {% endfor %}
        </div>
        {% endif %}
    </div>
</section>
{% endblock %}