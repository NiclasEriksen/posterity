{% extends "base.html" %}
{% block page_title %}Video: {{ custom_title }}{% endblock %}
{% block metadata %}
<meta property="og:site_name" content="Posterity video">
<meta property="og:title" content="{{ custom_title }}" />
<meta property="og:description" content="Content warning: {{ content_warning }}" />
<meta property="og:image" itemprop="image" content="{{ url_for('serve.static', filename='posterity.png') }}">
<meta property="og:type" content="video.movie" />
<meta property="og:video:duration" content="{{ duration }}" />
<meta property="og:video:tag" content="{{ content_warning }}" />
<meta property="og:video:release_date" content="{{ upload_time }}">
{% endblock %}
{% block content %}
        <div class="uk-container uk-padding-small uk-height-1-1 uk-padding-remove-top">
            <div class="uk-card uk-card-default uk-card-body uk-width-1-1 uk-text-center">
                <h2 class="uk-card-title">{{ custom_title }}</h2>
                {% if tags|length %}
                <h4>
                    {% for tag in tags %}
                        <span class="uk-label {% if tag.category > 1 %}uk-label-danger{% elif tag.category == 1 %}uk-label-danger{% endif %}">{{ tag.name }}</span>
                    {% endfor %}
                    {% for category in categories %}
                        <span class="uk-label uk-label-category">{{ category.name }}</span>
                    {% endfor %}
                </h4>
                {% endif %}
                <hr>
                <div class="uk-width-1-1 uk-height-1-1">
                    <div class="uk-text-center uk-width-1-1 video-content">
                        {% if status == 1 %}
                        <video
                        id="video-player"
                        class="video-js vjs-16-9 vjs-big-play-centered"
                        controls
                        preload="auto"
                        width="640"
                        loop="loop"
                        height="264"
                        poster=""
                        data-setup={}
                        >
                            <source src="{{ stream_path }}" type="video/mp4" />
                        </video>
                        {% elif status == 0 %}
                        Video is still downloading, page will refresh automatically when done.
                        {% endif %}
                    </div>
                </div>
            </div>
            {% if status == 1 %}
            <div>
            </div>
            {% endif %}
            <div class="uk-grid uk-width-1-1 uk-margin-remove uk-margin-top">

                {% if status == 0 %}
                <div class="uk-width-1-1 uk-background-muted uk-text-center uk-padding-small">
                    <h3 class="uk-text-muted uk-margin-remove-bottom">Downloading...</h3>
                </div>
                {% elif status == 1 %}
                <div class="uk-width-1-1 uk-background-muted uk-text-center uk-padding-small">
                    <a href="{{ dl_path }}" class="uk-link-heading"><h3 class="uk-text-primary uk-margin-remove-bottom">Click here to download MP4 file</h3></a>
                </div>
                {% elif status == 3 %}
                <div class="uk-width-1-1 uk-background-muted uk-text-center uk-padding-small">
                    <h3 class="uk-text-danger">Invalid URL, no video to download.</h3>
                </div>
                {% elif status == 4 %}
                <div class="uk-width-1-1 uk-background-muted uk-text-center uk-padding-remove">
                    <h3 class="uk-text-danger">Video might be region/age restricted and requires cookies (not implemented).</h3>
                </div>
                {% else %}
                <div class="uk-width-1-1 uk-background-muted uk-text-center uk-padding-remove">
                    <h3 class="uk-text-danger">Download failed.</h3>
                </div>
                {% endif %}

                {% if duplicate|length > 1 %}
                <div class="uk-width-1-1 uk-background-muted uk-text-center uk-padding-remove">
                    <h3 class="uk-text-warning">This video is a duplicate of <a href="/{{ duplicate }}">{{ duplicate }}</a>.</h3>
                </div>
                {% endif %}

                {% if current_user.is_authenticated and status != 0 %}
                <div class="uk-width-1-1 uk-padding-small uk-flex-center">
                    <div class="uk-grid uk-width-1-1 uk-margin-remove">
                        <div class="uk-width-1-1 uk-width-1-2@s uk-text-center uk-padding-small">
                            <a class="uk-button uk-button-primary" href="/edit_video/{{ video_id }}"><span uk-icon="icon: pencil"></span> Edit info</a>
                        </div>
                        <div class="uk-width-1-1 uk-width-1-2@s uk-text-center uk-padding-small">
                            <a class="uk-button uk-button-danger" href="/remove/{{ video_id }}" onclick="return confirm('Are you sure you want to delete this video?');"><span uk-icon="icon: trash"></span> Delete video</a>
                        </div>
                    </div>
                </div>
                {% endif %}
                <div class="uk-width-1-1 uk-width-1-2@m">
                    <div class="uk-grid uk-padding-small">
                        <div class="uk-width-1-6">
                            <span uk-icon="icon: quote-right; ratio: 2;"></span>
                        </div>
                        <div class="uk-width-5-6">
                            <p><i>{{ orig_title }}</i></p>
                        </div>
                    </div>
                </div>
                <div class="uk-width-1-1 uk-width-1-2@m">
                    <div class="uk-grid uk-padding-small">
                        <div class="uk-width-1-6">
                            <span uk-icon="icon: tv; ratio: 2;"></span>
                        </div>
                        <div class="uk-width-5-6">
                            <p>{{ video_format }}</p>
                        </div>
                    </div>
                </div>
                <div class="uk-width-1-1 uk-width-1-2@m">
                    <div class="uk-grid uk-padding-small">
                        <div class="uk-width-1-6">
                            <span uk-icon="icon: location; ratio: 2;"></span>
                        </div>
                        <div class="uk-width-5-6">
                            <p><a href="{{ orig_url }}" target="_blank" class="uk-icon-link" uk-icon="link">{{ source }}</a></p>
                        </div>
                    </div>
                </div>
                <div class="uk-width-1-1 uk-width-1-2@m">
                    <div class="uk-grid uk-padding-small">
                        <div class="uk-width-1-6">
                            <span uk-icon="icon: future; ratio: 2;"></span>
                        </div>
                        <div class="uk-width-5-6">
                            {% if video %}
                            <p>{{ video.duration_str_verbose }}</p>
                            {% else %}
                            <p>{{ duration }} seconds.</p>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
        </div>

        {% if status == 1 %}
        <script src="https://vjs.zencdn.net/7.18.1/video.min.js"></script>
        <script>
        var vid_element = document.getElementById("video-player");
        if (vid_element) {
            videojs('video-player', {}, function() {
                this.volume(0.5);
            });
        }
        </script>
        {% elif status == 0 %}
        <script src="{{ url_for('serve.static', filename='js/klippekort.js') }}"></script>
        <script>
            var video_id = window.location.pathname.replace("/", "");
            if (video_id.length > 1) {
                redirectOnComplete(video_id);
            }
        </script>
        {% endif %}
{% endblock %}