{% extends "base.html" %}
{% block page_title %}Video: {{ video.title }}{% endblock %}
{% block metadata %}<!-- OpenGraph metadata for video -->
        <meta name="description" content="{{ video.orig_title }}!">
        <meta property="og:site_name" content="Posterity video">
        <meta property="og:title" content="{{ video.title }}" />
        <meta property="og:description" content="{{ video.orig_title }}" />
        <meta property="og:image" itemprop="image" content="/preview/{{ video.video_id }}.png">
        <meta property="og:type" content="video" />
        <meta property="og:video" content="{{ stream_path }}" />
        <meta property="og:video:type" content="video/mp4" />
        <meta property="og:video:width" content="{{ video.width }}" />
        <meta property="og:video:height" content="{{ video.height }}" />
        <meta property="og:video:duration" content="{{ video.duration_seconds }}" />
        <meta property="og:video:release_date" content="{{ video.upload_time_iso8601 }}">
        <!-- Content tags -->{% for tag in video.tags_by_category %}
        <meta property="og:video:tag" content="{{ tag.name }}" />{% endfor %}
        <!-- Category tags -->{% for tag in video.categories %}
        <meta property="og:video:tag" content="{{ tag.name }}" />{% endfor %}
        <!-- End of OpenGraph metadata -->
        <!-- Twitter Meta Tags -->
        <meta name="twitter:card" content="player">
        <meta property="twitter:domain" content="posterity.no">
        <meta property="twitter:url" content="/{{ video.video_id }}/">
        <meta name="twitter:title" content="{{ video.title }}">
        <meta name="twitter:description" content="{{ video.orig_title }}">
        <meta name="twitter:image" content="/preview/{{ video.video_id }}.png">
        <!-- End of Twitter Meta Tags -->
{% endblock %}
{% block content %}
        <div class="uk-container uk-padding-remove uk-padding-small@m uk-height-1-1 uk-padding-remove-top">
            <div class="uk-card uk-card-default uk-card-body video-card uk-width-1-1 uk-text-center uk-padding-remove-top">
                <div class="uk-width-1-1 uk-height-1-1">
                    <div class="uk-text-center uk-width-1-1 video-content">
                        {% if video.status == 1 %}
                        <video
                        id="video-player"
                        class="video-js vjs-16-9 vjs-big-play-centered"
                        controls
                        preload="auto"
                        width="640"
                        loop="loop"
                        height="264"
                        poster=""
                        data-setup='{"poster":"/preview/{{ video.video_id }}.png"}'
                        >
                            <source src="{{ stream_path }}" type="video/mp4" />
                        </video>
                        {% elif video.status == 0 %}
                        <div class="uk-flex uk-margin uk-text-meta uk-flex-center uk-padding-large uk-height-large">
                            <div class="uk-position-center uk-padding-small">
                                <div class="video-spinner"></div>
                            </div>
                            <div class="uk-position-top uk-padding-small">
                                Video is still downloading, page will refresh automatically when done.
                            </div>
                        </div>
                        {% endif %}
                    </div>
                </div>
                <div class="uk-width-1-1 uk-padding-small">
                    <h2 class="uk-margin-remove-bottom">{{ video.title }}</h2>
                    {% for tag in video.tags_by_category %}
                    <span class="uk-label {% if tag.category > 1 %}uk-label-danger{% elif tag.category == 1 %}uk-label-warning{% endif %}">{{ tag.name }}</span>
                    {% endfor %}
                    {% for category in video.categories %}
                    <span class="uk-label uk-label-category">{{ category.name }}</span>
                    {% endfor %}
                </div>
            </div>
            <div class="uk-grid uk-width-1-1 uk-margin-remove uk-margin-vertical">
                {% if current_user.is_authenticated and status != 0 %}
                <div class="uk-width-1-1 uk-padding-small uk-flex-center">
                    <div class="uk-grid uk-width-1-1 uk-margin-remove">
                        <div class="uk-width-1-1 uk-width-1-2@s uk-text-center uk-padding-small">
                            <a class="uk-button uk-button-primary" href="/edit_video/{{ video.video_id }}"><span uk-icon="icon: pencil"></span> Edit info</a>
                        </div>
                        <div class="uk-width-1-1 uk-width-1-2@s uk-text-center uk-padding-small">
                            <a class="uk-button uk-button-danger" href="/remove/{{ video.video_id }}" onclick="return confirm('Are you sure you want to delete this video?');"><span uk-icon="icon: trash"></span> Delete video</a>
                        </div>
                    </div>
                </div>
                {% endif %}
                {% if video.status == 0 %}
                <div class="uk-width-1-1 uk-background-muted uk-text-center uk-padding-small">
                    <h3 class="uk-text-muted uk-margin-remove-bottom">Downloading...</h3>
                </div>
                {% elif video.status == 1 %}
                <div class="uk-width-1-1 uk-text-center uk-padding-small">
                    <a href="{{ dl_path }}"><h3 class="uk-text-primary uk-margin-remove-bottom">Click here to download video file</h3></a>
                </div>
                {% elif video.status == 3 %}
                <div class="uk-width-1-1 uk-background-muted uk-text-center uk-padding-small">
                    <h3 class="uk-text-danger">Invalid URL, no video to download.</h3>
                </div>
                {% elif video.status == 4 %}
                <div class="uk-width-1-1 uk-background-muted uk-text-center uk-padding-remove">
                    <h3 class="uk-text-danger">Video might be region/age restricted and requires cookies (not implemented).</h3>
                </div>
                {% else %}
                <div class="uk-width-1-1 uk-background-muted uk-text-center uk-padding-remove">
                    <h3 class="uk-text-danger">Download failed.</h3>
                </div>
                {% endif %}

                {% if duplicate|length > 1 %}
                <div class="uk-width-1-1 uk-background-muted uk-text-center uk-padding-remove">
                    <h3 class="uk-text-warning">This video is a duplicate of <a href="/{{ duplicate }}">{{ duplicate }}</a>.</h3>
                </div>
                {% endif %}
                <div class="uk-width-1-1 uk-width-1-2@m">
                    <div class="uk-grid uk-padding-small">
                        <div class="uk-width-1-6">
                            <span uk-icon="icon: quote-right; ratio: 2;"></span>
                        </div>
                        <div class="uk-width-5-6">
                            <p><i>{{ video.orig_title }}</i></p>
                        </div>
                    </div>
                </div>
                <div class="uk-width-1-1 uk-width-1-2@m">
                    <div class="uk-grid uk-padding-small">
                        <div class="uk-width-1-6">
                            <span uk-icon="icon: tv; ratio: 2;"></span>
                        </div>
                        <div class="uk-width-5-6">
                            <p>
                                {{ video.dimensions_str }}<br>
                                {{ video.format_str }}, {{ video.frame_rate_str }}<br>
                                {{ video.bit_rate_str }}, {{ video.file_size_str }}
                            </p>
                        </div>
                    </div>
                </div>
                <div class="uk-width-1-1 uk-width-1-2@m">
                    <div class="uk-grid uk-padding-small">
                        <div class="uk-width-1-6">
                            <span uk-icon="icon: location; ratio: 2;"></span>
                        </div>
                        <div class="uk-width-5-6">
                            <p><a href="{{ video.url }}" target="_blank" class="uk-icon-link" uk-icon="link">{{ video.source }}</a></p>
                        </div>
                    </div>
                </div>
                <div class="uk-width-1-1 uk-width-1-2@m">
                    <div class="uk-grid uk-padding-small">
                        <div class="uk-width-1-6">
                            <span uk-icon="icon: future; ratio: 2;"></span>
                        </div>
                        <div class="uk-width-5-6">
                            <p>{{ video.duration_str_verbose }}</p>
                        </div>
                    </div>
                </div>
            </div>
            <div class="uk-height-small"></div>
        </div>

        {% if video.status == 1 %}
        <script src="https://vjs.zencdn.net/7.18.1/video.min.js"></script>
        <script>
        var vid_element = document.getElementById("video-player");
        if (vid_element) {
            videojs('video-player', {}, function() {
                this.volume(0.5);
            });
        }
        </script>
        {% elif video.status == 0 %}
        <script src="{{ url_for('serve.static', filename='js/klippekort.js') }}"></script>
        <script>
            redirectOnComplete('{{ video.video_id }}');
        </script>
        {% endif %}
{% endblock %}