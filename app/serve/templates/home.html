{% extends "base.html" %}
{% block content %}
<style>
.disabled_a {
    pointer-events: none;
}
</style>
<div class="uk-container uk-grid uk-padding-small uk-height-1-1 uk-padding-remove-top uk-margin-remove" style="min-width:100%">
    <div
        class="uk-width-1-1 uk-width-1-4@l uk-dark uk-background-secondary uk-height-1-1 uk-margin uk-padding-remove"
        style="border: 1px dashed #CCC;border-top: 0;"
    >
        {% if keyword|length or current_page > 1 %}{% set hide_first = True %}{% else %}{% set hide_first = False %}{% endif %}
        <form action="" id="link-form" class="uk-form uk-padding-small uk-width-1-1 uk-height-1-1 link-form-toggle"{% if hide_first %} hidden{% endif %}>
            <input type="hidden" id="source_user" name="source_user" value="{{ current_user.username }}">
            <fieldset class="uk-fieldset uk-grid">

                <legend class="uk-legend uk-text-center uk-width-1-1">Post new video for posterity</legend>

                <div class="uk-margin uk-width-1-1">
                    <div class="uk-inline uk-width-1-1">
                        <span class="uk-form-icon" uk-icon="icon: link"></span>
                        <input class="uk-input" type="text" id="url" name="url" placeholder="URL" required>
                    </div>
                    <div class="uk-margin-small uk-width-1-1">
                        <button type="button" class="uk-button uk-button-secondary uk-button-small" id="suggest-button" onclick="suggestTitle();">Suggest title</button>
                    </div>
                </div>

                <div class="uk-margin uk-width-1-1">
                    <div class="uk-inline uk-width-1-1">
                        <span class="uk-form-icon" uk-icon="icon: quote-right"></span>
                        <input class="uk-input" type="text" id="title" name="title" placeholder="Descriptive title" required>
                    </div>
                </div>

                <div class="uk-margin uk-width-1-2 uk-width-1-1@l">
                    <div class="uk-form-label">Content warning</div>
                    <div class="uk-inline uk-width-1-1">
                        <span class="uk-form-icon" uk-icon="icon: warning"></span>
                        <select class="uk-input uk-select" id="content_warning" name="content_warning">
                            <option value="default">None</option>
                            {% for tag in tags %}
                            <option class="content-tag-option-{{ tag.category }}" value="{{ tag.id }}">{{ tag.name }}</option>
                            {% endfor %}
                        </select>
                    </div>
                </div>
                <div class="uk-margin uk-width-1-2 uk-width-1-1@l">
                    <div class="uk-form-label">Video type</div>
                    <div class="uk-inline uk-width-1-1">
                        <span class="uk-form-icon" uk-icon="icon: tag"></span>
                        <select class="uk-input uk-select" id="category" name="category">
                            <option value="default">None</option>
                            {% for tag in categories %}
                            <option class="category-option" value="{{ tag.id }}">{{ tag.name }}</option>
                            {% endfor %}
                        </select>
                    </div>
                </div>

                <div class="uk-width-1-1">
                    <span class="uk-text-small">
                        <span class="content-tag-option-2">Graphic</span> /
                        <span class="content-tag-option-1">Emotional</span> /
                        <span class="content-tag-option-0">Informative</span> /
                        <span class="uk-text-category">Video type</span>
                    </span><br>
                    {% if current_user.is_authenticated %}
                    {% if current_user.check_auth(AUTH_LEVEL_EDITOR) %}
                    <div class="uk-margin">
                        <label><input class="uk-checkbox" id="private-checkbox" name="private-checkbox" type="checkbox"> Mark as private</label>
                    </div>
                    {% endif %}
                    <span class="uk-text-meta"><i>You can add more tags and categories later</i></span>
                    {% else %}
                    <span class="uk-text-meta"><i>Link will need to be approved by an editor before it's archived.</i></span>
                    {% endif %}
                </div>

                <div class="uk-margin-left uk-width-1-1 uk-padding-small uk-flex uk-flex-center">
                    <button class="uk-button uk-button-default" type="submit" id="submit-button">Save for posterity</button>
                </div>
                <p id="video-post-status" class="uk-text-small uk-text-meta"></p>
            </fieldset>
        </form>
        {% if hide_first %}
        <div class="uk-width-1-1 uk-position-relative" style="height: 48px;">
            <a
                class="uk-icon-button uk-position-center"
                uk-icon="plus"
                uk-toggle="target: .link-form-toggle; animation: uk-animation-fade"
            >
            </a>
        </div>
        {% endif %}
    </div>
    <div class="uk-width-1-1 uk-width-3-4@l uk-padding-small">
        <div class="uk-grid uk-grid-small uk-text-small uk-padding-small uk-padding-remove-vertical">
            <div class="uk-width-1-1 uk-width-1-2@l uk-text-muted uk-text-center">
                <div class=" uk-position-relative uk-container uk-height-1-1">
                    <div class="uk-text-center uk-position-center uk-position-relative">
                        {% if keyword|length %}Search results for <b>"{{ keyword }}"</b><br>{% endif %}
                        {% if total_results > 0 %}
                            Showing {{ result_offset + 1 }} to {{ result_offset + total_results }} of {{ total }} (page {{ current_page }} of {{ max_page }})
                        {% else %}
                            No results to show.
                        {% endif %}
                    </div>
                </div>
            </div>
            <div class="uk-container uk-width-1-1 uk-width-1-2@l uk-height-1-1">
                <form class="uk-form uk-width-1-1" id="search_form" name="search_form" action="/" method="POST">
                    <div class="uk-margin-remove uk-padding-small">
                        <div class="uk-inline uk-width-1-1">
                            <a class="uk-form-icon uk-form-icon-flip" href="" onclick="document.search_form.submit();return false;" uk-icon="icon: search"></a>
                            <input class="uk-input" type="text" id="keyword" name="keyword" placeholder="Search videos..." value="{{ keyword }}">
                        </div>
                    </div>
                </form>
            </div>
            <div class="uk-width-1-2">
                <a
                    class="uk-input uk-button {% if current_page > 1 %}uk-button-secondary{% else %}disabled_a uk-button-muted{% endif %} uk-button-small"
                    href="{% if current_page > 1 %}/?p={{ current_page - 1 }}{% else %}#{% endif %}{% if keyword|length %}&q={{ keyword }}{% endif %}"
                >
                    <span uk-icon="icon: chevron-double-left"></span> Previous
                </a>
            </div>
            <div class="uk-width-1-2">
                <a
                    class="uk-input uk-button {% if current_page < max_page %}uk-button-secondary{% else %}disabled_a uk-button-muted{% endif %} uk-button-small"
                    href="{% if current_page < max_page %}/?p={{ current_page + 1 }}{% else %}#{% endif %}{% if keyword|length %}&q={{ keyword }}{% endif %}"
                >
                    Next <span uk-icon="icon: chevron-double-right"></span>
                </a>
            </div>
        </div>

        <table class="uk-table uk-table-small uk-table-responsive uk-table-justify uk-table-middle">
            <caption class="uk-visible@l">{% if keyword|length %}Search results{% else %}Archived videos, sorted by upload date.{% endif %}</caption>
            <thead>
                <tr>
                    <th class="uk-table-expand">Video</th>
                    <th class="uk-table-shrink uk-visible@s">Status/Source</th>
                    <th class="uk-table-shrink">Duration</th>
                    <th class="uk-table-shrink">Submitted</th>
                </tr>
            </thead>
            <tbody>
                {% for video in videos %}
                <tr>
                    <td class="uk-flex uk-flex-middle" style="min-height: 64px;">
                        <div class="list-thumbnail uk-position-relative" style="display: table-cell;">
                            <a href="/{{ video.video_id }}">
                                <img src="/thumbnail/{{ video.video_id }}.jpg" loading="lazy" class="thumbnail-rounded uk-position-absolute uk-position-center">
                            </a>
                        </div>
                        <div style="display: table-cell;">
                            <a href="/{{ video['video_id'] }}" class="uk-text-bold video-link{% if not video.ready_to_play %} video-link-not-ready{% endif %}">{{ video.title }}</a>
                            {% if video.tags|length or video.categories|length %}
                                <br>
                                {% set v = video %}
                                {% include "content_tag_list.html" %}
                                {% include "category_tag_list.html" %}
                            {% endif %}
                            {% if video.can_be_changed and video.user_can_edit(current_user) %}
                            <a href="/edit_video/{{ video.video_id }}" class="uk-icon-link" uk-icon="icon: pencil; ratio: 0.85"></a>
                            {% endif %}
                        </div>
                    </td>
                    <td class="uk-text-muted uk-text-small uk-visible@s" style="max-width: 20vw;">
                        <div>
                            <span class="uk-visible@m">
                                {% include "video_status_icons.html" %}
                            </span>

                        </div>
                        <hr class="uk-visible@m" style="margin-top: 2px; margin-bottom: 2px;">
                        <div style="overflow: hidden; white-space: nowrap; text-overflow: ellipsis;">
                            {% if current_user.is_authenticated %}<span class="uk-text-meta" uk-icon="icon: user; ratio: 0.6"></span> {{ video.source }}{% endif %}
                            <span uk-tooltip="title: {{ video.url }};pos: top-left;">
                                <a href="{{ video.url }}" target="_blank">
                                    {% if video.source_site_name|length %}
                                    <span class="uk-icon-link" uk-icon="icon: {{ video.source_site_name }}; ratio: 0.75"></span>
                                    {% endif %}
                                    {{ video.url[:128] }}
                                </a>
                            </span>
                        </div>

                    </td>
                    <td class="uk-text-muted uk-text-small"{% if video.status != STATUS_COMPLETED %} style="padding: 0!important;"{% endif %}>
                        <span uk-icon="icon: future; ratio: 0.6"></span><span> {{ video.duration_str }}</span>
                        <span class="uk-hidden@m"><span style="padding: 0 0.1rem 0 0.1rem;"> | </span>{% include "video_status_icons.html" %}</span>
                    </td>
                    <td class="uk-text-muted uk-text-small">
                        <div uk-tooltip="title: {{ video.upload_time_elapsed_verbose }};pos: top-left;">
                            <div style="overflow: hidden; white-space: nowrap; text-overflow: ellipsis;">
                                <span class="uk-hidden@m" uk-icon="icon: calendar; ratio: 0.6"></span> {{ video.upload_time_verbose }}
                            </div>
                        </div>
                    </td>
                </tr>
                {% endfor %}
            </tbody>

            <tfoot>
                <tr>
                    <td>Title</td>
                    <td>Status/Source</td>
                    <td>Duration</td>
                    <td>Submitted</td>
                </tr>
            </tfoot>
        </table>
        <div class="uk-grid uk-grid-small">
            <div class="uk-width-1-2">
                <a
                    class="uk-input uk-button {% if current_page > 1 %}uk-button-secondary{% else %}disabled_a uk-button-muted{% endif %} uk-button-small"
                    href="{% if current_page > 1 %}/?p={{ current_page - 1 }}{% else %}#{% endif %}{% if keyword|length %}&q={{ keyword }}{% endif %}"
                >
                    <span uk-icon="icon: chevron-double-left"></span> Previous
                </a>
            </div>
            <div class="uk-width-1-2">
                <a
                    class="uk-input uk-button {% if current_page < max_page %}uk-button-secondary{% else %}disabled_a uk-button-muted{% endif %} uk-button-small"
                    href="{% if current_page < max_page %}/?p={{ current_page + 1 }}{% else %}#{% endif %}{% if keyword|length %}&q={{ keyword }}{% endif %}"
                >
                    Next <span uk-icon="icon: chevron-double-right"></span>
                </a>
            </div>
        </div>
    </div>

</div>
<script src="{{ url_for('serve.static', filename='js/klippekort.js') }}"></script>
{% endblock %}